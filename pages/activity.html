<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Activity - Smart City App</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- Ionicons -->
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

  <style>
    * { font-family: "Poppins", sans-serif; }
    :root{
      --dark-green: #285430;
      --soft-green: #5f8d4e;
      --pastel-green: #a4be7b;
      --sand: #e5d9b6;
    }
  </style>
</head>

<body data-title="Activity" class="bg-gray-50">

  <!-- layouts injected here -->
  <div id="header"></div>
  <div id="sidebar"></div>

  <!-- Main content -->
  <main class="p-8 lg:ml-64 mt-28 space-y-8">

    <!-- Header row (title + controls) -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h1 class="text-3xl font-semibold text-[var(--dark-green)]">Activity</h1>
        <p class="text-sm text-[var(--soft-green)] mt-1">Riwayat & statistik perangkat Smart Home</p>
      </div>

      <!-- controls: search + filter -->
      <div class="flex gap-3 items-center">
        <div class="hidden sm:flex items-center bg-white rounded-full shadow px-3 py-2">
          <ion-icon name="search-outline" class="text-xl text-gray-500 mr-2"></ion-icon>
          <input id="searchInput" type="search" placeholder="Cari aktivitas..." class="outline-none w-52 text-sm"/>
        </div>

        <div class="flex items-center gap-2">
          <button data-filter="all" class="filter-btn px-3 py-2 rounded-full bg-[var(--pastel-green)] text-[var(--dark-green)] text-sm font-medium">All</button>
          <button data-filter="alerts" class="filter-btn px-3 py-2 rounded-full bg-white text-[var(--dark-green)] text-sm shadow">Alerts</button>
          <button data-filter="controls" class="filter-btn px-3 py-2 rounded-full bg-white text-[var(--dark-green)] text-sm shadow">Controls</button>
        </div>
      </div>
    </div>

    <!-- Activity summary (quick stats) -->
    <section class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <div class="p-5 rounded-2xl bg-[var(--sand)] shadow border border-[var(--pastel-green)]">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-lg bg-[var(--dark-green)] text-[var(--sand)]">
            <ion-icon name="flash-outline" class="text-2xl"></ion-icon>
          </div>
          <div>
            <div class="text-sm text-gray-600">Alerts (24h)</div>
            <div class="text-xl font-semibold text-[var(--dark-green)]">3</div>
          </div>
        </div>
      </div>

      <div class="p-5 rounded-2xl bg-[var(--sand)] shadow border border-[var(--pastel-green)]">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-lg bg-[var(--dark-green)] text-[var(--sand)]">
            <ion-icon name="speedometer-outline" class="text-2xl"></ion-icon>
          </div>
          <div>
            <div class="text-sm text-gray-600">Events</div>
            <div class="text-xl font-semibold text-[var(--dark-green)]">37</div>
          </div>
        </div>
      </div>

      <div class="p-5 rounded-2xl bg-[var(--sand)] shadow border border-[var(--pastel-green)]">
        <div class="flex items-center gap-4">
          <div class="p-3 rounded-lg bg-[var(--dark-green)] text-[var(--sand)]">
            <ion-icon name="time-outline" class="text-2xl"></ion-icon>
          </div>
          <div>
            <div class="text-sm text-gray-600">Avg. Response</div>
            <div class="text-xl font-semibold text-[var(--dark-green)]">1.2s</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Graph + Activity list -->
    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">

      <!-- Left: simple activity chart -->
      <div class="p-6 rounded-2xl bg-white shadow border border-[var(--pastel-green)]">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-[var(--dark-green)]">Activity (24h)</h3>
          <div class="text-sm text-gray-500">Last updated: just now</div>
        </div>

        <!-- Simple SVG bar chart (static demo) -->
        <div class="w-full h-48">
          <svg id="activityChart" viewBox="0 0 100 40" class="w-full h-full">
            <!-- grid background -->
            <rect x="0" y="0" width="100" height="40" fill="#fff"/>
            <!-- bars (example values) -->
            <g fill="var(--pastel-green)">
              <rect x="6"  y="20" width="6"  height="20" rx="1"></rect>
              <rect x="18" y="10" width="6"  height="30" rx="1"></rect>
              <rect x="30" y="14" width="6"  height="26" rx="1"></rect>
              <rect x="42" y="6"  width="6"  height="34" rx="1"></rect>
              <rect x="54" y="18" width="6"  height="22" rx="1"></rect>
              <rect x="66" y="12" width="6"  height="28" rx="1"></rect>
              <rect x="78" y="22" width="6"  height="18" rx="1"></rect>
              <rect x="90" y="8"  width="6"  height="32" rx="1"></rect>
            </g>
          </svg>
        </div>

        <div class="mt-4 text-xs text-gray-500">Grafik statis contoh — integrasikan data realtime (MQTT / Firebase) untuk live chart.</div>
      </div>

      <!-- Right: Activity log list -->
      <div class="p-6 rounded-2xl bg-white shadow border border-[var(--pastel-green)]">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-[var(--dark-green)]">Activity Log</h3>
          <button id="clearBtn" class="text-sm text-[var(--dark-green)] bg-[var(--pastel-green)] px-3 py-1 rounded-full">Clear</button>
        </div>

        <!-- list -->
        <ul id="activityList" class="space-y-3 max-h-64 overflow-auto pr-2">
          <!-- sample items -->
          <li class="flex items-start gap-3 p-3 rounded-lg bg-[var(--sand)]">
            <div class="p-2 rounded-full bg-[var(--dark-green)] text-[var(--sand)]">
              <ion-icon name="lock-closed-outline"></ion-icon>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <div class="text-sm font-medium text-[var(--dark-green)]">Pintu - RFID</div>
                  <div class="text-xs text-gray-600">Akses diterima oleh ID: 0xA23B</div>
                </div>
                <div class="text-xs text-gray-500">02:14</div>
              </div>
            </div>
          </li>

          <li class="flex items-start gap-3 p-3 rounded-lg bg-white border">
            <div class="p-2 rounded-full bg-[var(--soft-green)] text-white">
              <ion-icon name="bulb-outline"></ion-icon>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <div class="text-sm font-medium text-[var(--dark-green)]">Lampu - LDR</div>
                  <div class="text-xs text-gray-600">Cahaya rendah → menyalakan lampu</div>
                </div>
                <div class="text-xs text-gray-500">01:42</div>
              </div>
            </div>
          </li>

          <li class="flex items-start gap-3 p-3 rounded-lg bg-white border">
            <div class="p-2 rounded-full bg-[var(--dark-green)] text-[var(--sand)]">
              <ion-icon name="rainy-outline"></ion-icon>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-start">
                <div>
                  <div class="text-sm font-medium text-[var(--dark-green)]">Jemuran - Hujan</div>
                  <div class="text-xs text-gray-600">Hujan terdeteksi → menutup jemuran</div>
                </div>
                <div class="text-xs text-gray-500">00:50</div>
              </div>
            </div>
          </li>

        </ul>

        <!-- load more (demo) -->
        <div class="mt-4 text-center">
          <button id="loadMore" class="px-4 py-2 rounded-full bg-[var(--pastel-green)] text-[var(--dark-green)]">Load more</button>
        </div>
      </div>
    </section>

    <!-- Controls quick toggles -->
    <section>
      <h3 class="text-xl font-semibold text-[var(--dark-green)] mb-4">Quick Controls</h3>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <!-- Quick Toggle item -->
        <div class="p-4 rounded-xl bg-[var(--sand)] shadow border border-[var(--pastel-green)] flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-[var(--dark-green)]">Lampu Rumah</div>
            <div class="text-xs text-gray-600">Status: <span id="statusLight">ON</span></div>
          </div>
          <div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="toggleLight" type="checkbox" checked class="hidden">
              <span class="w-12 h-6 bg-white rounded-full relative shadow-inner toggle-track"></span>
            </label>
          </div>
        </div>

        <div class="p-4 rounded-xl bg-[var(--sand)] shadow border border-[var(--pastel-green)] flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-[var(--dark-green)]">AC</div>
            <div class="text-xs text-gray-600">Status: <span id="statusAC">OFF</span></div>
          </div>
          <div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="toggleAC" type="checkbox" class="hidden">
              <span class="w-12 h-6 bg-white rounded-full relative shadow-inner toggle-track"></span>
            </label>
          </div>
        </div>

        <div class="p-4 rounded-xl bg-[var(--sand)] shadow border border-[var(--pastel-green)] flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-[var(--dark-green)]">Fan</div>
            <div class="text-xs text-gray-600">Status: <span id="statusFan">OFF</span></div>
          </div>
          <div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="toggleFan" type="checkbox" class="hidden">
              <span class="w-12 h-6 bg-white rounded-full relative shadow-inner toggle-track"></span>
            </label>
          </div>
        </div>

        <div class="p-4 rounded-xl bg-[var(--sand)] shadow border border-[var(--pastel-green)] flex items-center justify-between">
          <div>
            <div class="text-sm font-medium text-[var(--dark-green)]">Alarm Kebakaran</div>
            <div class="text-xs text-gray-600">Status: <span id="statusFire">OFF</span></div>
          </div>
          <div>
            <label class="inline-flex items-center cursor-pointer">
              <input id="toggleFire" type="checkbox" class="hidden">
              <span class="w-12 h-6 bg-white rounded-full relative shadow-inner toggle-track"></span>
            </label>
          </div>
        </div>
      </div>
    </section>

  </main>

  <!-- bottom nav injected -->
  <div id="bottom-nav"></div>

  <!-- local script for interactions (keep small & dependency-free) -->
  <script>
    // load layouts (app.js should also do this; duplicate-safe)
    async function loadIfEmpty(id, url){
      const el = document.getElementById(id);
      if(!el) return;
      if(el.innerHTML.trim() === "") {
        try {
          const res = await fetch(url);
          el.innerHTML = await res.text();
        } catch(e){
          // ignore
        }
      }
    }
    document.addEventListener('DOMContentLoaded', ()=> {
      loadIfEmpty('header','/layouts/header.html');
      loadIfEmpty('sidebar','/layouts/sidebar.html');
      loadIfEmpty('bottom-nav','/layouts/bottom-nav.html');
    });

    // Filters
    document.addEventListener('click', (e)=>{
      if(e.target.matches('.filter-btn')) {
        document.querySelectorAll('.filter-btn').forEach(b=> b.classList.remove('bg-[var(--pastel-green)]','text-[var(--dark-green)']));
        e.target.classList.add('bg-[var(--pastel-green)]','text-[var(--dark-green)']);
        // for demo, no actual filtering of list included
      }
    });

    // simple toggles behavior
    function attachToggle(checkboxId, statusId, onText='ON', offText='OFF') {
      const cb = document.getElementById(checkboxId);
      const st = document.getElementById(statusId);
      if(!cb||!st) return;
      function update(){
        if(cb.checked) {
          st.textContent = onText;
          st.classList.remove('text-gray-600');
          st.classList.add('text-[var(--dark-green)]','font-medium');
        } else {
          st.textContent = offText;
          st.classList.remove('text-[var(--dark-green)]','font-medium');
          st.classList.add('text-gray-600');
        }
      }
      cb.addEventListener('change', update);
      update();
      // visual toggle track
      cb.previousElementSibling.addEventListener('click', ()=>{
        cb.checked = !cb.checked;
        cb.dispatchEvent(new Event('change'));
      });
    }
    // attach toggles
    attachToggle('toggleLight','statusLight','ON','OFF');
    attachToggle('toggleAC','statusAC','ON','OFF');
    attachToggle('toggleFan','statusFan','ON','OFF');
    attachToggle('toggleFire','statusFire','ARMED','OFF');

    // clear + load more demo
    document.getElementById('clearBtn').addEventListener('click', ()=>{
      const list = document.getElementById('activityList');
      list.innerHTML = '<li class="text-center text-gray-500 py-6">No activity</li>';
    });
    document.getElementById('loadMore').addEventListener('click', ()=>{
      const list = document.getElementById('activityList');
      const item = document.createElement('li');
      item.className = 'flex items-start gap-3 p-3 rounded-lg bg-white border';
      item.innerHTML = `
        <div class="p-2 rounded-full bg-[var(--soft-green)] text-white">
          <ion-icon name="phone-portrait-outline"></ion-icon>
        </div>
        <div class="flex-1">
          <div class="flex justify-between items-start">
            <div>
              <div class="text-sm font-medium text-[var(--dark-green)]">Bluetooth - Connected</div>
              <div class="text-xs text-gray-600">Perangkat: HC-05</div>
            </div>
            <div class="text-xs text-gray-500">now</div>
          </div>
        </div>
      `;
      list.appendChild(item);
      item.scrollIntoView({behavior:'smooth'});
    });

    // search filter (simple)
    document.getElementById('searchInput')?.addEventListener('input', (e)=>{
      const q = e.target.value.toLowerCase().trim();
      const items = document.querySelectorAll('#activityList li');
      items.forEach(li=>{
        const txt = li.innerText.toLowerCase();
        li.style.display = txt.includes(q) ? '' : 'none';
      });
    });
  </script>

  <!-- app.js (primary layout loader / nav) -->
  <script src="/app.js"></script>
</body>
</html>
